### HTTP 프로토콜의 특징

- 비 연결 지향
- Stateless
    - 연결을 끊는 순간 클라이언트와 서버의 통신이 끝나며 상태 정보를 유지하지 않는 특징

---

### 쿠키와 세션을 사용하는 이유

- HTTP 프로토콜의 약점을 보완하기 위해 사용됨
    - 비 연결 지향, stateless
- 통신이 끊어지면 상태정보가 유지되지 않기 때문에 매번 페이지를 이동할 때마다 로그인을 다시 해야함
- 상품 선택 후 구매 페이지에서 선택한 상품의 정보가 없거나 하는 등의 문제 발생

---

### **쿠키(Cookie)**

- HTTP의 일종으로 사용자가 어떤 웹 사이트를 방문할 경우 해당 사이트가 사용하고 있는 서버에서 사용자의 컴퓨터에 저장하는 작은 기록 정보 파일
- 클라이언트의 상태정보를 쿠키 형태로 클라이언트 PC에 저장하였다가 필요 시 정보를 참조하거나 재사용
- Key-Value 쌍으로 구성되어 있는 데이터파일이다
- 쿠키이름, 쿠키값, 만료시간, 전송할 도메인명, 전송할 경로, 보안연결여부, HttpOnly여부로 구성
- 도메인 당 20개의 쿠키를 가질 수있음
- 하나의 쿠키는 4KB까지 저장이 가능함

---

### 요청 흐름

1. **사용자 로그인**
    - 사용자가 아이디/비밀번호로 로그인 요청 (`POST /login`)을 보냄
    - 서버는 인증이 성공하면 **세션 ID 혹은 토큰(JWT 등)** 을 생성함
2. **서버 → 클라이언트로 쿠키 전송**
    - 서버는 생성한 세션 ID 또는 토큰을 **Set-Cookie 헤더**에 담아 응답함
    - 클라이언트(브라우저)는 이 값을 쿠키에 자동 저장함
3. **다음 요청부터는 쿠키 자동 전송**
    - 클라이언트는 이후 모든 요청에 해당 쿠키를 자동으로 포함해서 서버에 보냄
    - 서버는 쿠키를 보고 사용자를 인증함
    - 사용자가 지우지 않는다면 남아 있어 반 영구적

---

### 사용 이유

- 세션관리 (서버가 알아야할 정보를 저장, 장바구니, 유저 등)
- 개인화 (그 사람에 적절한 페이지를 띄울 수 있다)
- 트래킹 (분석)

---

### 단점

- 클라이언트에서 수정이 가능하기에 변조의 위험이 항상 존재
    - 쿠키 값을 암호화, 민감하거나 중요한 정보 x

---

### 쿠키의 종류

- 세션 쿠키
    - 일반적으로 만료 시간을 설정하고 메모리에만 저장되며 브라우저 종료 시 쿠키를 삭제
- Persistent 쿠키
    - 장시간 유지되는 쿠키, 파일로 저장되어 브라우저 종료와 관계 없이 사용 가능
- Secure 쿠키
    - HTTPS 프로토콜에서만 사용, 쿠키 정보가 암호화 되어 전송
- Third-Party 쿠키
    - 방문한 도메인과는 다른 도메인의 쿠키임, 광고 등을 관리 시 유입 경로를 추적하기 위해 사용

---

### 세션

- 웹 서버에 웹 컨테이너의 상태를 유지하기 위한 정보를 저장
- 웹 서버에 저장되는 쿠키
- 브라우저를 닫거나, 서버에서 세션을 삭제 해야만 삭제가 되기 때문에 쿠키보다 보안적으로 우수
- 저장 데이터에 제한이 없음
- 클라이언트에서 고유 세션 ID를 부여
    - 각 클라이언트의 요구에 맞는 서비스 제공

---

### 요청 흐름

1. 로그인 요청
2. 세션 생성
3. 세션 ID 전달
4. 쿠키 저장
5. 요청 시 쿠키 포함
6. 서버 식별
7. 세션 종료

---

### 세션 목적

- 사용자나 다른 누군가에게 노출되면 안되는 보안적으로 중요한 정보들을 서버 안에서 다루기 위해 사용

---

### 단점

- 세션의 내용은 서버에 저장되기 때문에 서버 부하가 생길 수 있음
- 정보가 서버에 있어 비교적 쿠키보다 느림

---

### 세션 vs 쿠키

|  | Cookie | Session |
| --- | --- | --- |
| 저장 위치 | Client | Server |
| 저장 형식 | Text | Object |
| 만료 시점 | 쿠키 저장 시 설정(설정 없으면 브라우저 종료 시) | 정확한 시점 모름 |
| 리소스 | 클라이언트의 리소스 | 서버의 리소스 |
| 용량 제한 | 한 도메인 당 20개, 한 쿠키 당 4KB | 제한 없음 |
| 속도 | 쿠키에 정보가 있어 비교적 빠름 | 정보가 서버에 있어 비교적 느림 |

---

### 왜 둘다 사용할까?

- 세션은 보안에 유리하지만 서버 자원을 소모하므로, 자원 절약과 성능 향상을 위해 쿠키와 병행 사용하는 것이 효율적임

### 한마디로

- 쿠키는 세션ID를 클라이언트에 저장하고 전달하는 **운반 도구**, 세션은 서버에서 사용자 정보를 관리하는 **저장소**
